!function(){"use strict";!function(t,e,n,s){t.RagChatWidget=s,t[s]=t[s]||function(){(t[s].q=t[s].q||[]).push(arguments)};const i="rag-chat-widget-state",a="rag-chat-widget-website-type",o=function(e){try{t.sessionStorage&&t.sessionStorage.setItem(i,JSON.stringify(e))}catch(t){}},r=function(){try{if(t.sessionStorage){const e=t.sessionStorage.getItem(i);return e?JSON.parse(e):null}}catch(t){}return null},h={detect:function(){try{if(t.sessionStorage){const e=t.sessionStorage.getItem(a);if(e)return e}}catch(t){}let e=[t.__REACT_DEVTOOLS_GLOBAL_HOOK__,t.__VUE__,t.ng,t.__NEXT_DATA__,t.history&&t.history.pushState&&!1===t.history.pushState.toString().includes("[native code]")].some(t=>null!=t);if(t.history&&t.history.pushState){const n=t.history.pushState,s=t.history.replaceState;t.history.pushState=function(){return e=!0,h._saveType("spa"),n.apply(t.history,arguments)},t.history.replaceState=function(){return e=!0,h._saveType("spa"),s.apply(t.history,arguments)}}t.addEventListener("popstate",function(){e=!0,h._saveType("spa")},{once:!0});const n=e?"spa":"mpa";return h._saveType(n),n},_saveType:function(e){try{t.sessionStorage&&t.sessionStorage.setItem(a,e)}catch(t){}},getType:function(){return h.detect()}};let l=null,c=!1;class d{constructor(t){this.config=t||{},this.host=null,this.root=null,this.isOpen=!1,this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.currentX=0,this.currentY=0,this.websiteType=h.getType(),this.messages=[],this.dragThreshold=5,this.hasMoved=!1,this.sessionId=null,this.isLoading=!1,this.DEFAULT_INITIAL_MESSAGE="„Åì„Çì„Å´„Å°„ÅØÔºÅ‰Ωï„Åã„ÅäÊâã‰ºù„ÅÑ„Åß„Åç„Çã„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü",this.restoreState(),this.initializeSessionId()}initializeSessionId(){const e="rag-chat-widget-session-id";try{if(t.sessionStorage){const n=t.sessionStorage.getItem(e);if(n)return void(this.sessionId=n)}}catch(t){}this.sessionId=this.generateSessionId();try{t.sessionStorage&&t.sessionStorage.setItem(e,this.sessionId)}catch(t){}}generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}getApiBaseUrl(){return this.config.apiBaseUrl?this.config.apiBaseUrl:void 0!==g&&g.env&&g.env.NEXT_PUBLIC_API_URL?g.env.NEXT_PUBLIC_API_URL:"/api/v1"}getWidgetBaseUrl(){const t=e.getElementsByTagName("script");for(let e=0;e<t.length;e++){const n=t[e].src;if(n&&n.includes("widget.js"))return n.substring(0,n.lastIndexOf("/"))}return this.config.widgetBaseUrl||"http://localhost:3001"}restoreState(){const t=r();t&&(this.isOpen=t.isOpen||!1,t.position&&(this.currentX=t.position.x||0,this.currentY=t.position.y||0),t.messages&&Array.isArray(t.messages)&&(this.messages=t.messages))}saveState(){o({isOpen:this.isOpen,position:{x:this.currentX,y:this.currentY},messages:this.messages})}init(){if(e.getElementById("rag-chat-widget")&&l)return l.config={...l.config,...this.config},void l.saveState();this.host=e.createElement("div"),this.host.id="rag-chat-widget",this.host.setAttribute("role","complementary"),this.host.setAttribute("aria-label","AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà");const n=r();n&&n.position?(this.host.style.position="fixed",this.host.style.right="auto",this.host.style.bottom="auto",this.host.style.left=n.position.x+"px",this.host.style.top=n.position.y+"px",this.currentX=n.position.x,this.currentY=n.position.y):(this.host.style.position="fixed",this.host.style.right="20px",this.host.style.bottom="20px",this.currentX=t.innerWidth-100,this.currentY=t.innerHeight-100),e.body.appendChild(this.host),this.root=this.host.attachShadow({mode:"open"}),this.createStyles(),this.createUI(),this.setupEventListeners(),"spa"===this.websiteType&&this.setupSPAMonitoring(),this.restoreMessages(),l=this,this.saveState()}createStyles(){const t=e.createElement("style");t.textContent="\n        :host {\n          all: initial;\n          position: fixed;\n          z-index: 999999;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;\n        }\n        \n        .widget-container {\n          position: relative;\n          display: flex;\n          flex-direction: column;\n        }\n        \n        .toggle {\n          width: 80px;\n          height: 80px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: #fff;\n          border: none;\n          cursor: move;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 0;\n          padding: 0;\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4), 0 2px 8px rgba(0, 0, 0, 0.1);\n          user-select: none;\n          -webkit-user-select: none;\n          position: relative;\n          overflow: hidden;\n        }\n\n        .toggle img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          border-radius: 50%;\n          pointer-events: none;\n        }\n        \n        .toggle::before {\n          content: '';\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          width: 0;\n          height: 0;\n          border-radius: 50%;\n          background: rgba(255, 255, 255, 0.3);\n          transform: translate(-50%, -50%);\n          transition: width 0.6s, height 0.6s;\n        }\n        \n        .toggle:hover::before {\n          width: 300px;\n          height: 300px;\n        }\n        \n        .toggle:hover {\n          transform: scale(1.1) translateY(-2px);\n          box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5), 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        \n        .toggle:focus {\n          outline: 3px solid rgba(102, 126, 234, 0.3);\n          outline-offset: 3px;\n        }\n        \n        .toggle:active {\n          transform: scale(1.05) translateY(0);\n        }\n        \n        .toggle.dragging {\n          opacity: 0.9;\n          cursor: grabbing;\n          box-shadow: 0 8px 24px rgba(102, 126, 234, 0.6), 0 4px 12px rgba(0, 0, 0, 0.2);\n        }\n        \n        .chat-dialog {\n          position: absolute;\n          bottom: 70px;\n          right: 0;\n          width: 400px;\n          height: 600px;\n          background: #ffffff;\n          border-radius: 20px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.05);\n          display: none;\n          flex-direction: column;\n          overflow: hidden;\n          animation: slideUpFade 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n          backdrop-filter: blur(10px);\n        }\n        \n        .chat-dialog.open {\n          display: flex;\n        }\n        \n        @keyframes slideUpFade {\n          from {\n            opacity: 0;\n            transform: translateY(30px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        \n        .chat-header {\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: #fff;\n          padding: 20px 24px;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        }\n        \n        .chat-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          letter-spacing: -0.02em;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .chat-header h3::before {\n          content: 'ü§ñ';\n          font-size: 20px;\n        }\n        \n        .chat-close {\n          background: rgba(255, 255, 255, 0.15);\n          border: none;\n          color: #fff;\n          font-size: 20px;\n          cursor: pointer;\n          padding: 0;\n          width: 36px;\n          height: 36px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 10px;\n          transition: all 0.2s ease;\n          font-weight: 300;\n        }\n        \n        .chat-close:hover {\n          background: rgba(255, 255, 255, 0.25);\n          transform: rotate(90deg);\n        }\n        \n        .chat-close:active {\n          transform: rotate(90deg) scale(0.95);\n        }\n        \n        .chat-clear {\n          background: rgba(255, 255, 255, 0.15);\n          border: none;\n          color: #fff;\n          font-size: 18px;\n          cursor: pointer;\n          padding: 0;\n          width: 36px;\n          height: 36px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 10px;\n          transition: all 0.2s ease;\n          margin-right: 8px;\n        }\n        \n        .chat-clear:hover {\n          background: rgba(255, 255, 255, 0.25);\n          transform: scale(1.1);\n        }\n        \n        .chat-clear:active {\n          transform: scale(1.05);\n        }\n        \n        .chat-messages {\n          flex: 1;\n          overflow-y: auto;\n          padding: 24px;\n          background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);\n          scroll-behavior: smooth;\n        }\n        \n        .chat-messages::-webkit-scrollbar {\n          width: 6px;\n        }\n        \n        .chat-messages::-webkit-scrollbar-track {\n          background: transparent;\n        }\n        \n        .chat-messages::-webkit-scrollbar-thumb {\n          background: rgba(0, 0, 0, 0.2);\n          border-radius: 3px;\n          border-radius: 3px;\n        }\n        \n        .chat-messages::-webkit-scrollbar-thumb:hover {\n          background: rgba(0, 0, 0, 0.3);\n        }\n        \n        .chat-input-area {\n          padding: 20px;\n          border-top: 1px solid rgba(0, 0, 0, 0.08);\n          display: flex;\n          gap: 12px;\n          background: #ffffff;\n          box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);\n        }\n        \n        .chat-input {\n          flex: 1;\n          padding: 14px 18px;\n          border: 2px solid #e8ecf0;\n          border-radius: 12px;\n          font-size: 14px;\n          font-family: inherit;\n          background: #f8f9fa;\n          transition: all 0.2s ease;\n          line-height: 1.5;\n        }\n        \n        .chat-input:focus {\n          outline: none;\n          border-color: #667eea;\n          background: #ffffff;\n          box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);\n        }\n        \n        .chat-input::placeholder {\n          color: #9ca3af;\n        }\n        \n        .chat-send {\n          padding: 14px 28px;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: #fff;\n          border: none;\n          border-radius: 12px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: 600;\n          transition: all 0.2s ease;\n          box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);\n          white-space: nowrap;\n        }\n        \n        .chat-send:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        }\n        \n        .chat-send:active {\n          transform: translateY(0);\n        }\n        \n        .chat-send:disabled {\n          background: #d1d5db;\n          cursor: not-allowed;\n          transform: none;\n          box-shadow: none;\n        }\n        \n        .message {\n          margin-bottom: 16px;\n          padding: 14px 18px;\n          border-radius: 18px;\n          max-width: 85%;\n          word-wrap: break-word;\n          line-height: 1.5;\n          font-size: 14px;\n          animation: messageSlideIn 0.3s ease;\n          position: relative;\n        }\n        \n        @keyframes messageSlideIn {\n          from {\n            opacity: 0;\n            transform: translateY(10px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n        \n        .message.user {\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: #fff;\n          margin-left: auto;\n          text-align: left;\n          border-bottom-right-radius: 4px;\n          box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);\n        }\n        \n        .message.bot {\n          background: #ffffff;\n          color: #1f2937;\n          border: 1px solid #e5e7eb;\n          border-bottom-left-radius: 4px;\n          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n        }\n        \n        .message a {\n          color: #667eea;\n          text-decoration: none;\n          word-break: break-all;\n          border-bottom: 1px solid rgba(102, 126, 234, 0.3);\n          transition: all 0.2s ease;\n          font-weight: 500;\n        }\n        \n        .message a:hover {\n          color: #764ba2;\n          border-bottom-color: #764ba2;\n        }\n        \n        .message.user a {\n          color: #fff;\n          border-bottom-color: rgba(255, 255, 255, 0.5);\n        }\n        \n        .message.user a:hover {\n          color: #f3f4f6;\n          border-bottom-color: rgba(255, 255, 255, 0.8);\n        }\n        \n        .message.loading {\n          opacity: 0.7;\n        }\n        \n        .loading-dots {\n          display: inline-block;\n          position: relative;\n        }\n        \n        .loading-dots::after {\n          content: '...';\n          animation: loadingDots 1.5s steps(4, end) infinite;\n        }\n        \n        @keyframes loadingDots {\n          0%, 20% {\n            content: '.';\n          }\n          40% {\n            content: '..';\n          }\n          60%, 100% {\n            content: '...';\n          }\n        }\n        \n        .message.error {\n          background: #fee2e2;\n          color: #991b1b;\n          border: 1px solid #fca5a5;\n        }\n        \n        .chat-send:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n        \n        .chat-input:disabled {\n          opacity: 0.6;\n          cursor: not-allowed;\n        }\n      ",this.root.appendChild(t)}createUI(){const t=e.createElement("div");t.className="widget-container";const n=e.createElement("button");n.className="toggle",n.setAttribute("aria-label","AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà„ÇíÈñã„Åè"),n.setAttribute("title","AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà„ÇíÈñã„Åè"),n.setAttribute("draggable","false");const s=e.createElement("img"),i=this.getWidgetBaseUrl();s.src=`${i}/assets/mascot/ciel.png`,s.alt="AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà",s.onerror=function(){n.textContent="üí¨",s.style.display="none"},n.appendChild(s);const a=e.createElement("div");a.className="chat-dialog",this.isOpen&&a.classList.add("open");const o=e.createElement("div");o.className="chat-header";const r=e.createElement("h3");r.innerHTML="<span>AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà</span>";const h=e.createElement("button");h.className="chat-clear",h.setAttribute("aria-label","‰ºöË©±Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢"),h.setAttribute("title","‰ºöË©±Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢"),h.innerHTML="üóëÔ∏è",h.addEventListener("click",()=>{confirm("‰ºöË©±Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü")&&this.clearMessages()});const l=e.createElement("button");l.className="chat-close",l.setAttribute("aria-label","„ÉÅ„É£„ÉÉ„Éà„ÇíÈñâ„Åò„Çã"),l.innerHTML="√ó",l.addEventListener("click",()=>this.closeDialog()),o.appendChild(r),o.appendChild(h),o.appendChild(l);const c=e.createElement("div");c.className="chat-messages",c.setAttribute("role","log"),c.setAttribute("aria-live","polite");const d=e.createElement("div");d.className="chat-input-area";const g=e.createElement("input");g.type="text",g.className="chat-input",g.placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...",g.setAttribute("aria-label","„É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•Âäõ");const p=e.createElement("button");p.className="chat-send",p.textContent="ÈÄÅ‰ø°",p.addEventListener("click",()=>{this.sendMessage(g)}),g.addEventListener("keypress",t=>{"Enter"===t.key&&this.sendMessage(g)}),d.appendChild(g),d.appendChild(p),a.appendChild(o),a.appendChild(c),a.appendChild(d),t.appendChild(n),t.appendChild(a),this.root.appendChild(t),this.toggleBtn=n,this.dialog=a,this.messagesArea=c,this.input=g,this.sendButton=p}setupEventListeners(){let e;this.setupDragAndDrop(),this.toggleBtn.addEventListener("click",t=>{this.isDragging||this.hasMoved||this.toggleDialog()}),t.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{this.adjustPositionOnResize()},100)})}setupDragAndDrop(){let n,s,i,a;const o=o=>{this.hasMoved=!1,this.isDragging=!1;const r=o.touches?o.touches[0].clientX:o.clientX,h=o.touches?o.touches[0].clientY:o.clientY;n=r,s=h;const l=this.host.getBoundingClientRect();i=l.left,a=l.top;const c=e=>{const o=e.touches?e.touches[0].clientX:e.clientX,r=e.touches?e.touches[0].clientY:e.clientY,h=o-n,l=r-s;if(Math.sqrt(h*h+l*l)>this.dragThreshold){this.isDragging||(this.isDragging=!0,this.toggleBtn.classList.add("dragging"),e.preventDefault()),this.hasMoved=!0;let n=i+h,s=a+l;const o=80,r=80,c=t.innerWidth-o,d=t.innerHeight-r;n=Math.max(0,Math.min(n,c)),s=Math.max(0,Math.min(s,d)),this.host.style.left=n+"px",this.host.style.top=s+"px",this.host.style.right="auto",this.host.style.bottom="auto",this.currentX=n,this.currentY=s}},d=()=>{this.isDragging&&this.saveState(),this.isDragging=!1,this.toggleBtn.classList.remove("dragging"),setTimeout(()=>{this.hasMoved=!1},100),e.removeEventListener("mousemove",c),e.removeEventListener("mouseup",d),e.removeEventListener("touchmove",c),e.removeEventListener("touchend",d)};e.addEventListener("mousemove",c),e.addEventListener("mouseup",d),e.addEventListener("touchmove",c,{passive:!1}),e.addEventListener("touchend",d)};this.toggleBtn.addEventListener("mousedown",o),this.toggleBtn.addEventListener("touchstart",o,{passive:!1})}adjustPositionOnResize(){if(!this.host)return;const e=this.host.getBoundingClientRect(),n=e.width||80,s=e.height||80,i=t.innerWidth,a=t.innerHeight;let o=this.currentX,r=this.currentY;"auto"!==this.host.style.right||"auto"!==this.host.style.bottom?("auto"!==this.host.style.right&&(o=i-n-(parseFloat(this.host.style.right)||20)),"auto"!==this.host.style.bottom&&(r=a-s-(parseFloat(this.host.style.bottom)||20))):(o=e.left,r=e.top);let h=!1,l=o,c=r;o+n>i&&(l=Math.max(0,i-n),h=!0),o<0&&(l=0,h=!0),r+s>a&&(c=Math.max(0,a-s),h=!0),r<0&&(c=0,h=!0),h&&(this.host.style.position="fixed",this.host.style.left=l+"px",this.host.style.top=c+"px",this.host.style.right="auto",this.host.style.bottom="auto",this.currentX=l,this.currentY=c,this.saveState())}setupSPAMonitoring(){t.MutationObserver&&new MutationObserver(t=>{!e.body.contains(this.host)&&this.host&&e.body.appendChild(this.host)}).observe(e.body,{childList:!0,subtree:!0})}shouldShowInitialMessage(){try{if(t.sessionStorage)return!t.sessionStorage.getItem("rag-chat-widget-initial-message-shown")}catch(t){}return!0}setInitialMessageShown(){try{t.sessionStorage&&t.sessionStorage.setItem("rag-chat-widget-initial-message-shown","true")}catch(t){}}resetInitialMessageFlag(){try{t.sessionStorage&&t.sessionStorage.removeItem("rag-chat-widget-initial-message-shown")}catch(t){}}showInitialMessage(){const t=this.config.initialMessage||this.DEFAULT_INITIAL_MESSAGE;this.addMessage(t,"bot"),this.setInitialMessageShown()}toggleDialog(){this.isOpen=!this.isOpen,this.isOpen?(this.dialog.classList.add("open"),this.input.focus(),this.shouldShowInitialMessage()&&this.showInitialMessage()):this.dialog.classList.remove("open"),this.saveState()}closeDialog(){this.isOpen=!1,this.dialog.classList.remove("open"),this.saveState()}async sendMessage(t){const e=t.value.trim();if(!e)return;if(this.isLoading)return;this.addMessage(e,"user"),t.value="",this.setLoading(!0);const n="loading-"+Date.now();this.addLoadingMessage(n);try{const t=await this.callChatAPI(e);this.removeLoadingMessage(n),t&&t.answer?this.addMessage(t.answer,"bot"):this.addMessage("ÂøúÁ≠î„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ","bot")}catch(t){this.removeLoadingMessage(n);let e="„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ";if(t.response){const n=t.response.status;401===n?e="Ë™çË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇAPI„Ç≠„Éº„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ":403===n?e="„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ":429===n?e="„É™„ÇØ„Ç®„Çπ„Éà„ÅåÂ§ö„Åô„Åé„Åæ„Åô„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ":n>=500&&(e="„Çµ„Éº„Éê„Éº„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Åó„Å∞„Çâ„Åè„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ")}else t.message&&t.message.includes("fetch")&&(e="„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");this.addMessage(e,"bot")}finally{this.setLoading(!1)}}async callChatAPI(t){const e=`${this.getApiBaseUrl()}/chats/widget/chat`;if(!this.config.tenantId||!this.config.apiKey)throw new Error("„ÉÜ„Éä„É≥„ÉàID„Åæ„Åü„ÅØAPI„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");const n={query:t,session_id:this.sessionId,model:this.config.model||null,max_tokens:this.config.maxTokens||null,temperature:this.config.temperature||null};try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-Tenant-ID":this.config.tenantId,"X-API-Key":this.config.apiKey},body:JSON.stringify(n)});if(!t.ok){const e=await t.json().catch(()=>({detail:t.statusText})),n=new Error(e.detail||`HTTP error! status: ${t.status}`);throw n.response={status:t.status,data:e},n}return await t.json()}catch(t){throw t}}setLoading(t){this.isLoading=t,this.sendButton&&(this.sendButton.disabled=t,this.sendButton.textContent=t?"ÈÄÅ‰ø°‰∏≠...":"ÈÄÅ‰ø°"),this.input&&(this.input.disabled=t)}addLoadingMessage(t){const n=e.createElement("div");n.className="message bot loading",n.id=t,n.innerHTML='<span class="loading-dots">ËÄÉ„Åà‰∏≠</span>',this.messagesArea.appendChild(n),this.messagesArea.scrollTop=this.messagesArea.scrollHeight}removeLoadingMessage(t){const e=this.messagesArea.querySelector("#"+t);e&&e.remove()}convertUrlsToLinks(t){const n=e.createDocumentFragment(),s=/(https?:\/\/[^\s<>"']+)/gi;let i,a=0;for(;null!==(i=s.exec(t));){if(i.index>a){const s=e.createTextNode(t.substring(a,i.index));n.appendChild(s)}const s=i[0];if(s.startsWith("http://")||s.startsWith("https://")){const t=e.createElement("a");t.href=s,t.textContent=s,t.target="_blank",t.rel="noopener noreferrer",t.setAttribute("aria-label",`Â§ñÈÉ®„É™„É≥„ÇØ: ${s}`),n.appendChild(t)}else{const t=e.createTextNode(s);n.appendChild(t)}a=i.index+i[0].length}if(a<t.length){const s=e.createTextNode(t.substring(a));n.appendChild(s)}if(0===n.childNodes.length){const s=e.createTextNode(t);n.appendChild(s)}return n}restoreMessages(){this.messages&&this.messages.length>0&&(this.messages.forEach(t=>{const n=e.createElement("div");n.className=`message ${t.type}`;const s=this.convertUrlsToLinks(t.text);n.appendChild(s),this.messagesArea.appendChild(n)}),this.messagesArea.scrollTop=this.messagesArea.scrollHeight)}addMessage(t,n){this.messages.push({text:t,type:n,timestamp:Date.now()});const s=e.createElement("div");s.className=`message ${n}`;const i=this.convertUrlsToLinks(t);s.appendChild(i),this.messagesArea.appendChild(s),this.messagesArea.scrollTop=this.messagesArea.scrollHeight,this.saveState()}clearMessages(){this.messages=[],this.messagesArea&&(this.messagesArea.innerHTML="");const t=r();t&&(t.messages=[],o(t)),this.resetInitialMessageFlag(),this.showInitialMessage(),this.saveState()}}const g=(t,e)=>{try{if("init"===t){const t=e[0]||{};if(c&&l)return void(l.config={...l.config,...t});new d(t).init(),c=!0}}catch(t){}};try{(t[s].q||[]).forEach(t=>{g(t[0],Array.prototype.slice.call(t,1))}),t[s]=function(){g(arguments[0],Array.prototype.slice.call(arguments,1))}}catch(t){}}(window,document,0,"ragChat")}();