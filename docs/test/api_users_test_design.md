# APIユーザー管理機能テスト設計書

## 1. 概要
本ドキュメントは、AI Chatbot APIのユーザー管理関連エンドポイントに対する包括的なテストケースを定義する。

## 2. テスト対象エンドポイント
- `GET /api/v1/users/me` (現在のユーザー情報取得)
- `PUT /api/v1/users/me` (現在のユーザー情報更新)
- `GET /api/v1/users/` (ユーザー一覧取得)
- `GET /api/v1/users/{user_id}` (ユーザー詳細取得)
- `PUT /api/v1/users/{user_id}` (ユーザー情報更新)
- `DELETE /api/v1/users/{user_id}` (ユーザー削除)
- `POST /api/v1/users/` (ユーザー作成)

## 3. バリデーションルール
認証APIテスト設計書と同じバリデーションルールを適用。

## 4. テストケース詳細

### 4.1. `GET /api/v1/users/me` (現在のユーザー情報取得)

#### 4.1.1. 正常系テストケース
- **ケース1**: 有効なトークンでユーザー情報取得
- **ケース2**: 全フィールドが正しく返却される

#### 4.1.2. 異常系テストケース
- **ケース1**: 無効なトークン
- **ケース2**: トークンなし
- **ケース3**: 非アクティブユーザー

### 4.2. `PUT /api/v1/users/me` (現在のユーザー情報更新)

#### 4.2.1. 正常系テストケース
- **ケース1**: 有効なデータで更新
- **ケース2**: 部分更新（一部フィールドのみ）

#### 4.2.2. 異常系テストケース
- **ケース1**: 無効なメールアドレス形式
- **ケース2**: 既存のメールアドレス
- **ケース3**: ロール変更試行（拒否されるべき）
- **ケース4**: 境界値テスト（最小長、最大長）

### 4.3. `GET /api/v1/users/` (ユーザー一覧取得)

#### 4.3.1. 正常系テストケース
- **ケース1**: デフォルトパラメータで取得
- **ケース2**: ページネーション（skip, limit）
- **ケース3**: フィルタリング（role, status）
- **ケース4**: 検索機能

#### 4.3.2. 異常系テストケース
- **ケース1**: 権限不足（OPERATORが全ユーザー取得試行）
- **ケース2**: 無効なページネーションパラメータ
- **ケース3**: 境界値テスト（limit=0, limit=1001）

### 4.4. `GET /api/v1/users/{user_id}` (ユーザー詳細取得)

#### 4.4.1. 正常系テストケース
- **ケース1**: 自分のユーザー情報取得
- **ケース2**: 管理者が他ユーザー情報取得

#### 4.4.2. 異常系テストケース
- **ケース1**: 存在しないユーザーID
- **ケース2**: 他テナントのユーザー取得試行
- **ケース3**: 権限不足

### 4.5. `PUT /api/v1/users/{user_id}` (ユーザー情報更新)

#### 4.5.1. 正常系テストケース
- **ケース1**: 管理者がユーザー情報更新
- **ケース2**: ロール変更（管理者のみ）

#### 4.5.2. 異常系テストケース
- **ケース1**: 権限不足
- **ケース2**: 無効なデータ
- **ケース3**: 他テナントのユーザー更新試行

### 4.6. `DELETE /api/v1/users/{user_id}` (ユーザー削除)

#### 4.6.1. 正常系テストケース
- **ケース1**: 管理者がユーザー削除
- **ケース2**: ソフトデリート確認

#### 4.6.2. 異常系テストケース
- **ケース1**: 権限不足
- **ケース2**: 存在しないユーザー
- **ケース3**: 自分自身の削除試行

### 4.7. `POST /api/v1/users/` (ユーザー作成)

#### 4.7.1. 正常系テストケース
- **ケース1**: 管理者がユーザー作成
- **ケース2**: 各種ロールでユーザー作成

#### 4.7.2. 異常系テストケース
- **ケース1**: 権限不足
- **ケース2**: 既存メールアドレス
- **ケース3**: 無効なデータ

## 5. 権限テスト

### 5.1. ロール別アクセス制御
- PLATFORM_ADMIN: 全ユーザーアクセス可能
- TENANT_ADMIN: 自テナントユーザーのみ
- OPERATOR: 自分のみ

## 6. セキュリティテスト
- SQLインジェクション対策
- XSS対策
- 認可チェック

