# APIコンテンツ管理機能テスト設計書

## 1. 概要
本ドキュメントは、AI Chatbot APIのコンテンツ管理関連エンドポイントに対する包括的なテストケースを定義する。

## 2. テスト対象エンドポイント
- `GET /api/v1/contents/` (コンテンツ一覧取得)
- `POST /api/v1/contents/` (コンテンツ作成)
- `GET /api/v1/contents/{content_id}` (コンテンツ詳細取得)
- `PUT /api/v1/contents/{content_id}` (コンテンツ更新)
- `DELETE /api/v1/contents/{content_id}` (コンテンツ削除)
- `POST /api/v1/contents/upload` (ファイルアップロード)
- `GET /api/v1/contents/{content_id}/chunks` (チャンク一覧取得)

## 3. バリデーションルール

### 3.1. ファイルサイズ
- 最小: 1バイト
- 最大: 100MB
- 境界値: 0バイト（無効）、1バイト（有効）、100MB（有効）、101MB（無効）

### 3.2. ファイルタイプ
- 許可: PDF, TXT, DOCX, MD
- 拒否: EXE, ZIP（設定による）

## 4. テストケース詳細

### 4.1. `GET /api/v1/contents/` (コンテンツ一覧取得)

#### 4.1.1. 正常系テストケース
- **ケース1**: デフォルトパラメータで取得
- **ケース2**: ページネーション
- **ケース3**: フィルタリング（file_type, status）
- **ケース4**: 検索機能

#### 4.1.2. 異常系テストケース
- **ケース1**: 無効なページネーションパラメータ
- **ケース2**: 権限不足

### 4.2. `POST /api/v1/contents/` (コンテンツ作成)

#### 4.2.1. 正常系テストケース
- **ケース1**: 有効なデータで作成
- **ケース2**: 各種ファイルタイプ

#### 4.2.2. 異常系テストケース
- **ケース1**: 必須フィールド欠損
- **ケース2**: 無効なファイルタイプ
- **ケース3**: 権限不足

### 4.3. `POST /api/v1/contents/upload` (ファイルアップロード)

#### 4.3.1. 正常系テストケース
- **ケース1**: 有効なファイルアップロード
- **ケース2**: 各種ファイル形式（PDF, TXT, DOCX, MD）
- **ケース3**: 境界値（1バイト、100MB）

#### 4.3.2. 異常系テストケース
- **ケース1**: ファイルサイズ超過（101MB）
- **ケース2**: 無効なファイル形式
- **ケース3**: 空ファイル
- **ケース4**: ファイル名に特殊文字
- **ケース5**: 非常に長いファイル名

### 4.4. `GET /api/v1/contents/{content_id}` (コンテンツ詳細取得)

#### 4.4.1. 正常系テストケース
- **ケース1**: 自分のコンテンツ取得
- **ケース2**: 管理者が全コンテンツ取得

#### 4.4.2. 異常系テストケース
- **ケース1**: 存在しないコンテンツID
- **ケース2**: 他テナントのコンテンツ取得試行
- **ケース3**: 権限不足

### 4.5. `PUT /api/v1/contents/{content_id}` (コンテンツ更新)

#### 4.5.1. 正常系テストケース
- **ケース1**: 有効なデータで更新
- **ケース2**: 部分更新

#### 4.5.2. 異常系テストケース
- **ケース1**: 権限不足
- **ケース2**: 無効なデータ
- **ケース3**: 他テナントのコンテンツ更新試行

### 4.6. `DELETE /api/v1/contents/{content_id}` (コンテンツ削除)

#### 4.6.1. 正常系テストケース
- **ケース1**: 自分のコンテンツ削除
- **ケース2**: 管理者がコンテンツ削除

#### 4.6.2. 異常系テストケース
- **ケース1**: 権限不足
- **ケース2**: 存在しないコンテンツ
- **ケース3**: 他テナントのコンテンツ削除試行

### 4.7. `GET /api/v1/contents/{content_id}/chunks` (チャンク一覧取得)

#### 4.7.1. 正常系テストケース
- **ケース1**: チャンク一覧取得
- **ケース2**: ページネーション

#### 4.7.2. 異常系テストケース
- **ケース1**: 存在しないコンテンツID
- **ケース2**: 権限不足

## 5. セキュリティテスト
- ファイルアップロード時のウイルススキャン（将来実装）
- ファイル名のサニタイズ
- パストラバーサル対策

