# フロントエンド認証機能テスト設計書（更新版）

## 1. 概要
本ドキュメントは、AI Chatbotフロントエンドの認証関連コンポーネントに対する包括的なテストケースを定義する。
Jest + React Testing Libraryを用いたコンポーネントテストと、Playwrightを用いたE2Eテストを想定している。

## 2. テスト対象コンポーネント
- `LoginForm` (ログインフォーム)
- `TenantRegistrationForm` (テナント登録フォーム)
- `PasswordResetForm` (パスワードリセットフォーム)
- `/login` (ログインページ)
- `/password-reset` (パスワードリセットページ)
- `/verify-email` (メール検証ページ)

## 3. コンポーネントテスト（Jest + React Testing Library）

### 3.1. `LoginForm` コンポーネント

#### 3.1.1. 正常系テストケース

**ケース1: フォームの初期表示**
- テスト内容: フォームが正しく表示される
- 期待結果: メールアドレス入力欄、パスワード入力欄、ログインボタンが表示される

**ケース2: 有効な入力でログイン成功**
- テスト内容: 有効なメールアドレスとパスワードを入力して送信
- 期待結果: ログインAPIが呼ばれ、成功時にダッシュボードに遷移

**ケース3: パスワード表示切り替え**
- テスト内容: パスワード表示/非表示ボタンをクリック
- 期待結果: パスワードの表示/非表示が切り替わる

**ケース4: タブ切り替え**
- テスト内容: ログインタブと登録タブを切り替え
- 期待結果: それぞれのフォームが表示される

#### 3.1.2. 異常系テストケース

**ケース1: 無効なメールアドレス形式**
- テスト内容: "invalid-email"を入力
- 期待結果: バリデーションエラーメッセージが表示される

**ケース2: 空のメールアドレス**
- テスト内容: メールアドレスを空欄にして送信
- 期待結果: バリデーションエラーメッセージが表示される

**ケース3: 空のパスワード**
- テスト内容: パスワードを空欄にして送信
- 期待結果: バリデーションエラーメッセージが表示される

**ケース4: ログイン失敗時のエラー表示**
- テスト内容: 無効な認証情報でログイン試行
- 期待結果: エラーメッセージが表示される

**ケース5: ローディング状態の表示**
- テスト内容: ログイン送信後
- 期待結果: ローディングインジケーターが表示される

### 3.2. `TenantRegistrationForm` コンポーネント

#### 3.2.1. 正常系テストケース

**ケース1: フォームの初期表示**
- テスト内容: フォームが正しく表示される
- 期待結果: 全入力欄が表示される

**ケース2: 有効な入力で登録成功**
- テスト内容: 有効なデータを入力して送信
- 期待結果: 登録APIが呼ばれ、成功時にログインページに遷移

**ケース3: パスワード確認の一致チェック**
- テスト内容: パスワードと確認パスワードが一致する場合
- 期待結果: バリデーションエラーが表示されない

#### 3.2.2. 異常系テストケース

**ケース1: テナント名の最小長チェック**
- テスト内容: 1文字のテナント名を入力
- 期待結果: バリデーションエラーメッセージが表示される

**ケース2: テナント識別子の形式チェック**
- テスト内容: 無効な文字（スペース、特殊文字）を含む識別子
- 期待結果: バリデーションエラーメッセージが表示される

**ケース3: パスワード確認の不一致**
- テスト内容: パスワードと確認パスワードが異なる
- 期待結果: バリデーションエラーメッセージが表示される

**ケース4: パスワード強度チェック**
- テスト内容: 弱いパスワード（大文字なし、数字なしなど）
- 期待結果: バリデーションエラーメッセージが表示される

**ケース5: 境界値テスト**
- テスト内容: 最小長、最大長の境界値
- 期待結果: 適切にバリデーションされる

### 3.3. `PasswordResetForm` コンポーネント

#### 3.3.1. 正常系テストケース

**ケース1: 有効なメールアドレスでリセット要求**
- テスト内容: 有効なメールアドレスを入力して送信
- 期待結果: リセットAPIが呼ばれ、成功メッセージが表示される

#### 3.3.2. 異常系テストケース

**ケース1: 無効なメールアドレス形式**
- テスト内容: 無効なメールアドレスを入力
- 期待結果: バリデーションエラーメッセージが表示される

**ケース2: 空のメールアドレス**
- テスト内容: メールアドレスを空欄にして送信
- 期待結果: バリデーションエラーメッセージが表示される

## 4. E2Eテスト（Playwright）

### 4.1. ログインフロー

#### 4.1.1. 正常系テストケース

**ケース1: 有効な認証情報でログイン**
- 操作: ログインページにアクセス → メールアドレスとパスワードを入力 → ログインボタンをクリック
- 期待結果: ダッシュボードページにリダイレクトされ、ユーザー名が表示される

**ケース2: パスワードリセットリンクの確認**
- 操作: ログインページにアクセス → 「パスワードをお忘れですか？」リンクをクリック
- 期待結果: パスワードリセット要求ページに遷移する

#### 4.1.2. 異常系テストケース

**ケース1: 登録されていないメールアドレスでログイン**
- 操作: 未登録のメールアドレスと任意のパスワードを入力してログイン
- 期待結果: エラーメッセージ「Incorrect email or password」が表示される

**ケース2: 間違ったパスワードでログイン**
- 操作: 登録済みのメールアドレスと間違ったパスワードを入力してログイン
- 期待結果: エラーメッセージ「Incorrect email or password」が表示される

**ケース3: バリデーションエラーの表示**
- 操作: 無効なメールアドレス形式を入力してログイン
- 期待結果: バリデーションエラーメッセージが表示される

### 4.2. テナント登録フロー

#### 4.2.1. 正常系テストケース

**ケース1: 有効な情報で登録**
- 操作: 登録ページにアクセス → 有効な情報を入力 → 登録ボタンをクリック
- 期待結果: 登録成功メッセージが表示され、ログインページに遷移する

#### 4.2.2. 異常系テストケース

**ケース1: 既存のメールアドレスで登録**
- 操作: 既存のメールアドレスで登録試行
- 期待結果: エラーメッセージ「Email already registered」が表示される

**ケース2: バリデーションエラーの表示**
- 操作: 無効なデータを入力して登録試行
- 期待結果: 適切なバリデーションエラーメッセージが表示される

### 4.3. パスワードリセットフロー

#### 4.3.1. 正常系テストケース

**ケース1: 登録済みのメールアドレスでリセット要求**
- 操作: パスワードリセットページにアクセス → 登録済みのメールアドレスを入力 → 送信
- 期待結果: 成功メッセージが表示される

#### 4.3.2. 異常系テストケース

**ケース1: 無効なメールアドレス形式**
- 操作: 無効なメールアドレス形式を入力して送信
- 期待結果: バリデーションエラーメッセージが表示される

### 4.4. メール検証フロー

#### 4.4.1. 正常系テストケース

**ケース1: 有効な検証トークンでメール検証**
- 操作: 有効な検証トークンを含むURLにアクセス
- 期待結果: 成功メッセージが表示され、ログインページまたはダッシュボードにリダイレクトされる

#### 4.4.2. 異常系テストケース

**ケース1: 無効な検証トークン**
- 操作: 無効な検証トークンを含むURLにアクセス
- 期待結果: エラーメッセージが表示される

**ケース2: トークンなし**
- 操作: トークンを含まないURLにアクセス
- 期待結果: エラーメッセージが表示されるか、ログインページにリダイレクトされる

## 5. アクセシビリティテスト

### 5.1. キーボードナビゲーション
- Tabキーでフォーカス移動
- Enterキーでフォーム送信

### 5.2. スクリーンリーダー対応
- 適切なaria-label
- エラーメッセージの読み上げ

## 6. パフォーマンステスト

### 6.1. レンダリング時間
- 初回レンダリング: 1秒以内
- フォーム送信後のレスポンス: 3秒以内

## 7. テスト実行手順

```bash
# コンポーネントテスト
cd frontend
npm test

# E2Eテスト
npm run test:e2e
```

## 8. 期待されるカバレッジ

- 行カバレッジ: 85%以上
- 分岐カバレッジ: 80%以上
- 関数カバレッジ: 90%以上
