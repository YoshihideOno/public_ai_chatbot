---
# RAG AI チャットボットプラットフォーム サービス説明書

## 目次

1. [システム概要](#システム概要)
2. [主な機能](#主な機能)
3. [ユーザーロールと権限](#ユーザーロールと権限)
4. [機能詳細](#機能詳細)
5. [使用方法](#使用方法)
6. [システム要件](#システム要件)
7. [注意事項](#注意事項)
8. [サポート](#サポート)

---

## システム概要

本システムは、RAG（Retrieval-Augmented Generation）技術を活用したAIチャットボットプラットフォームです。独自のナレッジベースを構築し、文書検索とAI生成を組み合わせた高精度な回答を提供します。

### 特徴

- **RAG技術**: 文書検索と生成AIを組み合わせた回答
- **マルチテナント対応**: 組織ごとにデータを分離
- **セキュリティ**: 認証・認可、データ保護
- **スケーラブル**: 水平スケール対応

---

## 主な機能

### 1. ナレッジベース管理
- ファイル/URLからのコンテンツ登録
- 自動チャンク分割とベクトル化
- コンテンツの検索・編集・削除

### 2. AIチャット機能
- RAGによる文脈に基づく回答
- 会話履歴の管理
- 複数のLLMモデルに対応

### 3. ダッシュボード
- 統計情報の確認
- システム状況の監視
- 設定状況の確認

### 4. テナント設定
- LLMモデルの選択
- APIキーの管理
- テナント情報の管理

### 5. ユーザー管理（管理者向け）
- ユーザーの作成・編集・削除
- ロール管理
- アクセス制御

### 6. 埋め込みウィジェット / 外部サイト連携
- WebサイトやWebアプリケーションへのチャットボット埋め込み
- テナントごとのウィジェット用APIキー発行
- 環境変数を利用したウィジェットCDN・APIエンドポイントの設定

---

## ユーザーロールと権限

本システムは4つのロールで運用します。

### プラットフォーム管理者（PLATFORM_ADMIN）
- 全システムの管理
- 全テナントのユーザー管理
- テナントの作成・削除
- 全リソースへのアクセス

### テナント管理者（TENANT_ADMIN）
- 自テナントの管理
- 自テナント内のユーザー管理
- テナント設定の変更
- コンテンツ管理

### 運用者（OPERATOR）
- コンテンツ管理
- チャット機能の利用
- 統計情報の確認
- 設定変更（制限あり）

### 監査者（AUDITOR）
- ログ閲覧
- 監査データのエクスポート
- 読み取り専用のアクセス

---

## 機能詳細

### ダッシュボード

ログイン後に表示されるメイン画面です。

#### 表示内容
- **ユーザー情報カード**: 基本情報とロール
- **統計カード**（管理者向け）:
  - 総質問数
  - アクティブユーザー数
  - 平均応答時間
  - 評価率
- **システム設定状況**:
  - チャット用モデル設定状況
  - ベクトル埋め込みモデル設定状況
  - APIキー設定状況
  - システム使用可能状態
- **システム状況**（管理者向け）:
  - コンテンツ数
  - 処理中・インデックス済み・失敗の統計
- **最近の活動履歴**

### コンテンツ管理

ナレッジベースに登録するコンテンツを管理します。

#### 対応ファイル形式
- PDF（.pdf）
- HTML（.html, .htm）
- Markdown（.md）
- CSV（.csv）
- テキスト（.txt）

#### コンテンツの登録方法

**方法1: ファイルアップロード**
1. 「新規コンテンツ」をクリック
2. ラジオボタンで「ファイルをアップロード」を選択
3. ファイルを選択（ドラッグ&ドロップ可）
4. タイトル、説明、タグを入力
5. 「保存」をクリック

**方法2: URL入力**
1. 「新規コンテンツ」をクリック
2. ラジオボタンで「URLを入力」を選択
3. URLを入力（例: `https://example.com/document.pdf`）
4. 自動でファイルタイプが判定されます
5. タイトル、説明、タグを入力（タイトルは自動設定可）
6. 「保存」をクリック

#### コンテンツの処理フロー
1. **アップロード完了（UPLOADED）**: ファイルまたはURLからコンテンツを登録
2. **処理中（PROCESSING）**: テキスト抽出とチャンク分割を実行
3. **インデックス済み（INDEXED）**: ベクトル化が完了し検索可能
4. **失敗（FAILED）**: エラー発生時は再処理が必要

#### コンテンツの管理機能
- **編集**: タイトル、説明、タグの更新
- **削除**: 不要なコンテンツの削除
- **再インデックス**: 処理に失敗した場合の再処理
- **複製**: 既存コンテンツのコピー作成
- **チャンク情報の確認**: 分割されたチャンクの確認

#### チャンク設定
- **チャンクサイズ**: デフォルト1024文字、範囲256-4096文字
- **チャンクオーバーラップ**: デフォルト200文字、範囲0-512文字
- コンテンツ登録時に個別に設定可能

### AIチャット機能

登録したナレッジベースを利用してAIと対話します。

#### 使用方法
1. チャット画面を開く
2. 質問を入力
3. システムが関連コンテンツを検索
4. 検索結果を基に回答を生成
5. 会話履歴が自動保存

#### 設定可能なパラメータ
- **LLMモデル**: 使用する生成AIモデルの選択
- **最大トークン数**: 回答の長さを制御（デフォルト500）
- **温度パラメータ**: 回答の創造性を制御（デフォルト0.7、範囲0.0-1.0）

### 埋め込みウィジェット機能

外部サイトにチャットボットを埋め込み、訪問ユーザーからの質問にRAGで回答します。

#### 主な特徴
- 1行のスクリプトタグを貼り付けるだけで導入可能なウィジェット
- テナントごとに発行されたウィジェット用APIキーによる認証
- 本体アプリケーションと同じナレッジベースと設定を共有

#### 利用イメージ
1. 管理画面からウィジェット用埋め込みコード（スニペット）を取得
2. 自社WebサイトやヘルプページのHTMLにスニペットを貼り付け
3. 設定されたテナント・モデル・APIキーに基づき、ページ上でチャットボットが利用可能

#### 設定に利用する主な環境変数（例）
- **WIDGET_CDN_URL**: ウィジェットJavaScriptの配信URL
- **API_BASE_URL / NEXT_PUBLIC_API_URL**: バックエンドAPIのベースURL
- **NEXT_PUBLIC_WIDGET_TENANT_ID / NEXT_PUBLIC_WIDGET_API_KEY**: ウィジェット用テナントID・APIキー

### テナント設定

テナント固有の設定を管理します。

#### LLMモデル設定

**チャット用モデル**
- チャット応答に使用するモデルを選択
- 対応プロバイダー:
  - **OpenAI**: 
    - gpt-4
    - gpt-4-turbo
    - gpt-3.5-turbo
    - gpt-4o
    - gpt-4o-mini
  - **Anthropic**: 
    - claude-3-opus
    - claude-3-sonnet
    - claude-3-haiku
    - claude-3-5-sonnet
  - **Google**: 
    - gemini-pro
    - gemini-pro-vision
    - gemini-1.5-pro
    - gemini-1.5-flash

**ベクトル埋め込みモデル**
- 文書検索用の埋め込みベクトル生成に使用
- チャット用モデルと異なるモデルを選択可能
- チャット用モデルと同じモデル一覧から選択

#### APIキー管理

**APIキーの登録**
1. 「APIキー」セクションを開く
2. 「新規登録」をクリック
3. プロバイダーを選択（openai, anthropic, google）
4. モデルを選択
5. APIキーを入力
6. 「登録」をクリック

**APIキーの管理**
- **有効/無効の切り替え**: スイッチで切り替え
- **編集**: APIキーやモデルの更新
- **削除**: 不要なAPIキーの削除

**注意事項**
- チャット用モデルとベクトル埋め込みモデルが異なる場合、それぞれに対応するAPIキーが必要
- 同一モデルを使用する場合は、1つのAPIキーで対応可能
- 無効なAPIキーはチャット機能で使用されません
- 各プロバイダーごとに複数のAPIキーを登録可能

### ユーザー管理（管理者向け）

プラットフォーム管理者およびテナント管理者が、ユーザーを管理します。

#### ユーザーの作成
1. 「ユーザー管理」画面を開く
2. 「新規ユーザー」をクリック
3. メールアドレス、ユーザー名、パスワード、ロールを入力
4. テナント管理者の場合は、テナントを指定
5. 「作成」をクリック

#### ユーザーの編集・削除
- **編集**: ユーザー情報、ロール、アクティブ状態の更新
- **削除**: ユーザーの削除（確認ダイアログあり）

---

## 使用方法

### 初回セットアップ手順

1. **アカウント登録・ログイン**
   - 管理者からアカウントを作成してもらう、または自己登録

2. **システム設定の確認**
   - ダッシュボードでシステム設定状況を確認
   - 不足があれば「テナント設定」をクリック

3. **LLMモデルの設定**
   - 「テナント設定」→「LLMモデル」タブ
   - チャット用モデルとベクトル埋め込みモデルを選択
   - 未選択の場合は「未選択」を選択可能

4. **APIキーの登録**
   - 「テナント設定」→「APIキー」タブ
   - 使用するモデルに対応するAPIキーを登録
   - 有効化されていることを確認

5. **コンテンツの登録**
   - 「コンテンツ管理」→「新規コンテンツ」
   - ファイルまたはURLからコンテンツを登録
   - インデックス完了を確認

6. **チャット機能の利用**
   - チャット画面で質問を入力
   - AIからの回答を確認

### 日常的な使用方法

1. **コンテンツの追加**
   - 新しい情報をナレッジベースに追加
   - 定期的にコンテンツを更新

2. **チャットの利用**
   - 登録したナレッジベースに対して質問
   - 回答の精度を確認し、必要に応じてコンテンツを改善

3. **統計情報の確認**
   - ダッシュボードで利用状況を確認
   - システムの健康状態を監視

---

## システム要件

### ブラウザ要件
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### ファイルサイズ制限
- 1ファイルあたり最大50MB

### 対応ファイル形式
- PDF, HTML, Markdown, CSV, テキストファイル

### チャンク設定制限
- チャンクサイズ: 256-4096文字（デフォルト1024文字）
- チャンクオーバーラップ: 0-512文字（デフォルト200文字）

### タグ制限
- 1コンテンツあたり最大10個のタグ
- 各タグは最大50文字

### タイトル・説明制限
- タイトル: 最大255文字
- 説明: 最大1000文字

---

## 注意事項

### セキュリティ
- APIキーは厳重に管理してください
- パスワードは定期的に変更してください
- 不要なユーザーアカウントは削除してください

### データ管理
- 機密情報を含むコンテンツの登録には注意してください
- 定期的に不要なコンテンツを削除してください
- データのバックアップは管理者に確認してください

### パフォーマンス
- 大量のコンテンツを登録する場合は、処理に時間がかかることがあります
- インデックス処理中は、チャット機能の精度が一時的に低下する可能性があります
- チャンクサイズを大きくすると、検索精度は向上しますが、処理時間が長くなります

### APIキーの管理
- 有効なAPIキーがないと、チャット機能が利用できません
- 複数のモデルを使用する場合は、それぞれに対応するAPIキーが必要です
- APIキーは定期的にローテーションすることを推奨します
- 各プロバイダー（OpenAI、Anthropic、Google）ごとにAPIキーを登録する必要があります

### コンテンツ処理
- URLからのコンテンツ取得は、30秒以内に完了する必要があります
- 処理に失敗した場合は、エラーメッセージを確認し、必要に応じて再インデックスを実行してください
- ファイル形式が正しく認識されない場合は、ファイル拡張子を確認してください

---

## サポート

### トラブルシューティング

**チャット機能が動作しない場合**
1. ダッシュボードでシステム設定状況を確認
2. チャット用モデルが選択されているか確認
3. APIキーが有効か確認
4. コンテンツがインデックス済みか確認

**コンテンツがインデックスされない場合**
1. コンテンツのステータスを確認
2. 処理が失敗している場合は、再インデックスを実行
3. ファイル形式が対応しているか確認
4. ファイルサイズが制限内か確認
5. エラーメッセージを確認

**ログインできない場合**
1. メールアドレスとパスワードを確認
2. アカウントがアクティブか確認（管理者に確認）
3. ブラウザのキャッシュをクリア

**URLからのコンテンツ取得に失敗する場合**
1. URLが正しくアクセス可能か確認
2. URLが公開されているか確認（認証が必要なURLは対応していません）
3. ファイルサイズが50MB以内か確認
4. 対応しているファイル形式か確認

### お問い合わせ

技術的な問題や質問がある場合は、管理者にお問い合わせください。

---

**最終更新日**: 2025年12月  
**バージョン**: 1.1.0

---

