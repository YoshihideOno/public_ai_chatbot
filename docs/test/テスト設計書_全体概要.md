# テスト設計書 - 全体概要

## 1. 概要

本ドキュメントは、RAG AI Chatbot Platformの包括的なテスト設計書です。
システム開発企業の標準的な品質基準に基づき、単体テスト、統合テスト、E2Eテストの設計を定義します。

## 2. テスト戦略

### 2.1. テストピラミッド

```
        /\
       /E2E\
      /------\
     / 統合  \
    /--------\
   /  単体   \
  /----------\
```

- **単体テスト（70%）**: 関数・メソッド・コンポーネント単位のテスト
- **統合テスト（20%）**: APIエンドポイント、サービス層の連携テスト
- **E2Eテスト（10%）**: ユーザーシナリオベースのテスト

### 2.2. テストカバレッジ目標

- **バックエンド**: 80%以上
- **フロントエンド**: 80%以上
- **E2E**: 主要フロー100%

### 2.3. テスト分類

1. **正常系テスト**: 期待される動作の確認
2. **異常系テスト**: エラーハンドリングの確認
3. **境界値テスト**: 境界値・限界値の確認
4. **セキュリティテスト**: 認証・認可・入力検証の確認
5. **パフォーマンステスト**: レスポンス時間・負荷の確認

## 3. テスト対象範囲

### 3.1. バックエンドAPI

- 認証エンドポイント (`/api/v1/auth/*`)
- ユーザー管理エンドポイント (`/api/v1/users/*`)
- テナント管理エンドポイント (`/api/v1/tenants/*`)
- チャットエンドポイント (`/api/v1/chats/*`)
- コンテンツ管理エンドポイント (`/api/v1/contents/*`)
- 統計エンドポイント (`/api/v1/stats/*`)
- 課金エンドポイント (`/api/v1/billing/*`)
- APIキー管理エンドポイント (`/api/v1/api-keys/*`)
- 監査ログエンドポイント (`/api/v1/audit-logs/*`)

### 3.2. フロントエンドコンポーネント

- 認証コンポーネント（ログイン、登録、パスワードリセット）
- ダッシュボードコンポーネント
- コンテンツ管理コンポーネント
- テナント管理コンポーネント
- ユーザー管理コンポーネント
- 設定コンポーネント
- 統計コンポーネント

### 3.3. E2Eテストシナリオ

- ユーザー登録・ログインフロー
- コンテンツアップロード・管理フロー
- チャット機能フロー
- テナント管理フロー
- 設定変更フロー

## 4. テスト設計書一覧

### バックエンドAPIテスト設計

1. [認証APIテスト設計書](./api_auth_test_design.md)
2. [ユーザー管理APIテスト設計書](./api_users_test_design.md)
3. [テナント管理APIテスト設計書](./api_tenants_test_design.md)
4. [チャットAPIテスト設計書](./api_chats_test_design.md)
5. [コンテンツ管理APIテスト設計書](./api_contents_test_design.md)
6. [統計APIテスト設計書](./api_stats_test_design.md)
7. [課金APIテスト設計書](./api_billing_test_design.md)
8. [APIキー管理APIテスト設計書](./api_api_keys_test_design.md)
9. [監査ログAPIテスト設計書](./api_audit_logs_test_design.md)

### フロントエンドコンポーネントテスト設計

1. [認証コンポーネントテスト設計書](./frontend_auth_test_design.md)
2. [ダッシュボードコンポーネントテスト設計書](./frontend_dashboard_test_design.md)
3. [コンテンツ管理コンポーネントテスト設計書](./frontend_contents_test_design.md)
4. [テナント管理コンポーネントテスト設計書](./frontend_tenants_test_design.md)
5. [ユーザー管理コンポーネントテスト設計書](./frontend_users_test_design.md)
6. [設定コンポーネントテスト設計書](./frontend_settings_test_design.md)
7. [統計コンポーネントテスト設計書](./frontend_stats_test_design.md)

### E2Eテスト設計

1. [認証フローE2Eテスト設計書](./e2e_auth_test_design.md)
2. [コンテンツ管理フローE2Eテスト設計書](./e2e_contents_test_design.md)
3. [チャット機能フローE2Eテスト設計書](./e2e_chat_test_design.md)
4. [テナント管理フローE2Eテスト設計書](./e2e_tenants_test_design.md)
5. [統合シナリオE2Eテスト設計書](./e2e_integration_test_design.md)

## 5. テスト実行環境

### 5.1. バックエンド

- **テストフレームワーク**: pytest
- **非同期テスト**: pytest-asyncio
- **HTTPクライアント**: httpx
- **モック**: unittest.mock, pytest-mock
- **カバレッジ**: pytest-cov

### 5.2. フロントエンド

- **テストフレームワーク**: Jest
- **コンポーネントテスト**: React Testing Library
- **モック**: jest.mock
- **カバレッジ**: jest --coverage

### 5.3. E2E

- **テストフレームワーク**: Playwright
- **ブラウザ**: Chromium, Firefox, WebKit
- **実行環境**: CI/CD (GitHub Actions)

## 6. テストデータ管理

### 6.1. テストデータ作成

- 各テスト前に必要なデータを作成
- テスト後にデータをクリーンアップ
- テスト間でデータが干渉しないよう分離

### 6.2. フィクスチャ

- ユーザーフィクスチャ（各種ロール）
- テナントフィクスチャ
- コンテンツフィクスチャ
- モックデータ

## 7. テスト実行手順

### 7.1. ローカル実行

```bash
# バックエンド
cd api
pytest -v --cov=app tests/

# フロントエンド
cd frontend
npm test

# E2E
cd frontend
npm run test:e2e
```

### 7.2. CI/CD実行

GitHub Actionsで自動実行（`.github/workflows/ci.yml`）

## 8. 品質基準

### 8.1. 必須要件

- 全てのテストが通過すること
- カバレッジ目標を達成すること
- テスト実行時間が許容範囲内であること

### 8.2. テスト品質

- テストケースが明確であること
- テストが独立していること
- テストが再現可能であること
- テストが保守しやすいこと

## 9. 用語定義

- **正常系**: 期待される正常な動作
- **異常系**: エラーケースや不正な入力
- **境界値**: データの有効範囲の境界
- **統合テスト**: 複数コンポーネントの連携テスト
- **E2Eテスト**: エンドツーエンドのユーザーシナリオテスト

